# 8. Requerimiento para importación programa de contabilidad

## 1. Objetivo

Establecer los requerimientos técnicos necesarios para que ENBLAU pueda generar archivos compatibles con el programa de contabilidad, utilizando transformación de datos mediante **XSLT** y exportación a formatos específicos, con las codificaciones aceptadas.

---

## 2. Requerimientos generales

1. **Formato de Entrada:**
   - El sistema externo deberá generar archivos en formato **XML** como base para la transformación.
   - El archivo XML debe cumplir con la estructura establecida en el esquema XSD (si aplica).
   - Se debe proporcionar un protocolo claro de mapeo de campos.

2. **Transformación:**
   - La transformación del XML a formato de importación será realizada mediante un archivo **XSLT** proporcionado por el proveedor o desarrollado internamente.
   - El archivo XSLT debe cumplir con la especificación 1.0 o 2.0 según compatibilidad con el motor XSLT del sistema.

3. **Formato de exportación:**
   El resultado de la transformación debe generarse en uno de los siguientes formatos, según lo definido para cada tipo de operación contable:

   | Tipo de Archivo | Descripción                         |
   |-----------------|-------------------------------------|
   | `.dat`          | Formato de texto plano estructurado |
   | `.txt`          | Texto delimitado (ej. tabulador, coma) |
   | `.xml`          | Estructura XML compatible            |
   | `.xlsx`         | Hoja de cálculo (Excel)             |

4. **Codificación de texto:**
   La codificación de los archivos debe ser una de las siguientes, según el tipo de archivo:

   | Codificación | Recomendado para |
   |--------------|------------------|
   | ANSI         | `.txt`, `.dat` antiguos |
   | UTF-8        | `.xml`, `.txt` modernos |
   | UTF-16       | `.xml` con caracteres especiales |
   | UNICODE      | General para archivos multilenguaje |

---

## 3. Protocolo de integración

1. **Enlace de descarga de la plantilla XSLT:**
   El proveedor del sistema contable deberá proporcionar el archivo XSLT base para realizar la transformación. 

2. **Especificación de Mapeo de Campos:**
   Debe entregarse un documento que detalle:

   - Nombre del campo en el sistema origen
   - Posiciones
   - Longitud (caracteres)
   - Tipo de dato (numérico, texto, fecha)
   - Formato requerido (ej: `dd/MM/yyyy`, `#,##0.00`, etc.)

   **Ejemplo de tabla de mapeo:**

    A continuación se detalla la estructura esperada para el archivo de importación según el **Tipo de registro = 0**, correspondiente a **Alta de Apuntes sin IVA**.

    | Posiciones | Longitud (caracteres)  | Descripción del Campo     | Comentarios                                                               |
    |------------|------------------------|--------------------------|----------------------------------------------------------------------------|
    | 1          | 1                      | Tipo de Formato          | Constante `5`                                                              |
    | 2 a 6      | 5                      | Código de empresa        | Valores entre `00001` y `99999`                                            |
    | 7 a 14     | 8                      | Fecha del apunte         | Formato `aaaammdd` (Ejemplo: 1 de febrero de 2000 → `20000201`)            |
    | 15         | 1                      | Tipo de Registro         | Constante `0`                                                              |
    | 16 a 27    | 12                     | Cuenta                   | Nivel 6 a 12. Si no existe la cuenta, se dará de alta automáticamente.     |

**Observaciones**:
- Este formato debe generarse como un archivo de texto plano (`.txt` o `.dat`) con codificación **ANSI**.
- Los campos deben ocupar exactamente las posiciones indicadas. No debe haber delimitadores.
- Todos los registros deben cumplir con la estructura de longitud fija para ser válidos.

---

## 4. Transformación desde XML con XSLT

La estructura anterior puede generarse a partir de un archivo XML de entrada, transformado con una plantilla XSLT. Se recomienda que el archivo XML tenga los siguientes nodos mínimos:

'XML'
<Apuntes>
  <Apunte>
    <CodigoEmpresa>00001</CodigoEmpresa>
    <Fecha>20000201</Fecha>
    <Cuenta>430000000001</Cuenta>
  </Apunte>
</Apuntes>

---

## 5. Validaciones previas

- El archivo XML debe pasar validación estructural (bien formado y, si aplica, válido contra XSD).
- La salida del XSLT debe revisarse para asegurar compatibilidad con el formato de importación contable.
- Se recomienda utilizar herramientas como **Saxon**, **Altova XMLSpy** o librerías como **lxml** en Python para validar y probar transformaciones.

---

## 6. Proceso de importación y exportación desde ENBLAU

1. Generar XML desde el sistema origen.
2. Aplicar transformación con el archivo XSLT.
3. Exportar el archivo resultante en el formato y codificación requerida.
4. Cargar el archivo en el módulo de importación del programa contable.
5. Verificar consistencia de los datos y completar la importación.

---

**Observaciones**

- Cualquier cambio en el formato fuente XML o en la estructura del archivo XSLT debe ser documentado y validado antes de ser implementado en producción.
- Es recomendable mantener un control de versiones tanto de los XSLT como de los esquemas XML.

---



